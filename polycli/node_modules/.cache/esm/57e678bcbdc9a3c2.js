let fs,shell,tunnelpaper,utils,getMetadata;_bdc‍.x([["handle_pfam",()=>handle_pfam]]);_bdc‍.w("fs",[["default",["fs"],function(v){fs=v}]]);_bdc‍.w("shelljs",[["default",["shell"],function(v){shell=v}]]);_bdc‍.w("./../assets/kdd-paper-table",[["*",null,function(v){tunnelpaper=v}]]);_bdc‍.w("./utils",[["*",null,function(v){utils=v}]]);_bdc‍.w("./../processing/getMetadata",[["getMetadata",["getMetadata"],function(v){getMetadata=v}]]);






const save_format_profile_with_pfam_matches = async (molecule_pdbid, depositionDirectory) => {

    let pdbid = molecule_pdbid.toUpperCase();
    if (!fs.existsSync(depositionDirectory)) {
        _bdc‍.g.console.log("Creating directory: ", depositionDirectory);
        shell.mkdir('-p', depositionDirectory);
    }

    var profile;
    console.log(`Constructing PFAM profile ${pdbid} based on RCSB.`);

    profile = await utils.addPfamTagsToRCSBProfile(pdbid);

    const metadata = getMetadata(pdbid,profile);

    profile = {
        metadata,
        [pdbid.toUpperCase()]: profile
    }

    fs.writeFileSync(depositionDirectory + `${pdbid}.json`, JSON.stringify(profile, null, 4), 'utf8',
        () => { console.log(`${pdibd} saved to disk.\n`) })
}

       const handle_pfam = async (templates) => {
    const depositionDirectory = './static/pfam/'
    if (templates[0] === 'single') {

        console.log(`Tagging molecule [ ${templates[1]} ] with PFAM groups.`);
        try {
            await save_format_profile_with_pfam_matches(templates[1], depositionDirectory)
        } catch (e) {
            console.log("Likely misspelled something.")
            _bdc‍.g.console.log(e)
        }
    } else if (templates[0] === 'batch') {

        var targetmolecules = Object.keys(tunnelpaper.structs_kdd2019)
        _bdc‍.g.console.log(targetmolecules)
        targetmolecules.forEach(pdbid => save_format_profile_with_pfam_matches(pdbid, depositionDirectory))

    } else {
        console.log('Invalid template argument.');
        process.exit(1)
    }


}

